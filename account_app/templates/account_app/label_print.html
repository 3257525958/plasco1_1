{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>چاپ لیبل‌ها</title>
    <style>
        @media print {
            body * {
                visibility: hidden;
            }
            .labels-container, .labels-container * {
                visibility: visible;
            }
            .labels-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none !important;
            }
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .label {
            width: {{ label_width }}mm;
            height: {{ label_height }}mm;
            border: 1px solid #ddd;
            margin: 1.5mm 1mm;
            display: inline-block;
            page-break-inside: avoid;
            background: white;
            text-align: center;
            padding: 2mm;
            box-sizing: border-box;
            vertical-align: top;
        }

        .product-name {
            font-size: 8pt;
            font-weight: bold;
            margin-bottom: 1mm;
            height: 12pt;
            overflow: hidden;
        }

        .barcode {
            font-family: 'Libre Barcode 128', cursive;
            font-size: 16pt;
            margin: 1mm 0;
            letter-spacing: 1px;
        }

        .price {
            font-size: 8pt;
            margin-top: 1mm;
            font-weight: bold;
        }

        .labels-container {
            width: 84mm; /* 2 * (40mm + 2mm margin) */
            margin: 0 auto;
        }

        .no-print {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .btn {
            padding: 10px 20px;
            margin: 0 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Vazirmatn', sans-serif;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Barcode+128&display=swap" rel="stylesheet">
</head>
<body>
    <div class="no-print">
        <h2>پیش‌نمایش لیبل‌ها</h2>
        <p>چاپگر: MEVA 4200 | سایز لیبل: 40×20 میلی‌متر</p>
        <button onclick="window.print()" class="btn btn-primary">
            <i class="fas fa-print"></i> چاپ لیبل‌ها
        </button>
        <a href="{% url 'label_settings' %}" class="btn">
            <i class="fas fa-edit"></i> ویرایش تنظیمات
        </a>
        <a href="{% url 'label_generator' %}" class="btn">
            <i class="fas fa-plus"></i> افزودن کالای جدید
        </a>
    </div>

    <div class="labels-container">
        {% for item in cart %}
            {% for i in item.quantity|default:1|get_range %}
            <div class="label">
                {% if item.show_name %}
                <div class="product-name">{{ item.product_name }}</div>
                {% endif %}

                <div class="barcode">*{{ item.barcode }}*</div>

                {% if item.show_price %}
                <div class="price">{{ item.price }} تومان</div>
                {% endif %}
            </div>
            {% endfor %}
        {% endfor %}
    </div>

    <!-- template tag برای تولید range -->
    {% with ''|center:10 as range %}
    {% endwith %}
</body>
</html>